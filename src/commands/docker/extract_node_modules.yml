parameters:
  image_repo:
    description: The container image repository
    type: string
  platform:
    description: Platform to build against
    type: enum
    default: "linux/amd64"
    enum: ["linux/amd64", "linux/arm64"]
  node_version:
    description: Node version
    type: string
steps:
  - staged_buildx:
      image_repo: << parameters.image_repo >>
      target: node_modules
      platforms: << parameters.platform >>
      output: type=local,dest=./node_modules
      extra_build_args: NODE_VERSION=<< parameters.node_version >>
