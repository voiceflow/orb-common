description: Uses vfcli to reset database and free an environment back into the pool

parameters:
  env-name:
    type: string
    description: Name of the environment to create
steps:
  - run:
      name: Release or Delete Env
      when: << parameters.when >>
      command: |
        env_name="<< parameters.env-name >>"
        echo "Releasing the environment..... $env_name"
        vfcli env resume "$env_name" --interactive false
        vfcli track attach --branch master --components all --name "$env_name" --interactive false --no-circleci
        vfcli env database reset --name "$env_name"
        vfcli component restart --name "$env_name" --wait
        vfcli pool free-env --env-name "$env_name"
