description: Uses vfcli to delete an environment

parameters:
  env-name:
    type: string
    description: Name of the environment to create
  when:
    type: string
    description: When to run this command
    default: always
steps:
  - attach_workspace:
      at: workspace
  - run:
      name: Delete Env << parameters.env-name >>
      when: << parameters.when >>
      command: |
        if [[ -f "workspace/env_name" ]]; then
          env_name=$(cat workspace/env_name)
          if [[ -n "$env_name" ]]; then
            vfcli pool release-env --env-name "$env_name"
          else
            vfcli env delete --name "<< parameters.env-name >>" --interactive false
          fi
        else
          vfcli env delete --name "<< parameters.env-name >>" --interactive false
        fi
