description: Uses vfcli to suspend an existing environment with a set of tracks (vfcli must already be installed)

parameters:
  env-name:
    type: string
    description: Name of the environment to prepare
  track-file:
    type: string
    description: Path to the track-mapping file to use
steps:
  - restore_cache:
      key: env_name_cache
  - run:
      name: Suspend Environment
      command: |
        if [[ -f env_name.txt ]]; then
          env_name=$(cat env_name.txt)
        else
          env_name="<< parameters.env-name >>"
        fi
        if [[ "$env_name" == "null" ]] || [[ -z "$env_name" ]]; then
          # If env_name from file is "null" or empty, use the default parameter
          env_name="<< parameters.env-name >>"
        fi

        vfcli env suspend "$env_name" --interactive false --track-file "<< parameters.track-file >>"
