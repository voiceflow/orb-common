parameters:
  service_name:
    description: Name of the Voiceflow service
    type: string
  github_username:
    description: username for cloning git repositories
    type: env_var_name
  github_token:
    description: token for cloning git repositories
    type: env_var_name
  commit:
    description: git commit hash for service repo
    type: string
    default: ""
  yarn_install_extra_args:
    description: Additional yarn command options
    type: string
    default: ""
steps:
  - clone_repo:
      step_name: "Clone << parameters.service_name >> repository"
      github_username: "<< parameters.github_username >>"
      github_token: "<< parameters.github_token >>"
      github_repo_name: "<< parameters.service_name >>"
      github_commit: "<< parameters.commit >>"
      path_to_clone: "~/<< parameters.service_name >>"
  - install_node_modules:
      install_args: "<< parameters.yarn_install_extra_args >>"
      avoid_post_install_scripts: false
      working_directory: "~/<< parameters.service_name >>"
      yarn_lock_restore_cache_directory: "~/<< parameters.service_name >>"
  - gen_certs_e2e:
      step_name: "Set up << parameters.service_name >>"
      working_directory: "~/<< parameters.service_name >>"
  - start_e2e:
      step_name: "Start << parameters.service_name >>"
      run_in_background: true
      working_directory: "~/<< parameters.service_name >>"
  - check_e2e_deps:
      step_name: "Start << parameters.service_name >>"
      working_directory: "~/<< parameters.service_name >>"
