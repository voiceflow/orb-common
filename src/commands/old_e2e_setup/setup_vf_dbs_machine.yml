parameters:
  github_username:
    description: username for cloning git repositories
    type: env_var_name
  github_token:
    description: token for cloning git repositories
    type: env_var_name
  commit:
    description: git commit hash for database-cli
    type: string
    default: ""
steps:
  - clone_repo:
      step_name: "Downloading dbcli"
      github_username: "<< parameters.github_username >>"
      github_token: "<< parameters.github_token >>"
      github_repo_name: "database-cli"
      path_to_clone: "~/code/database-cli"
      github_commit: "<< parameters.commit >>"

  - vf_restore_cache:
      yarn_lock_restore_cache_directory: ~/code/database-cli
      cache_prefix: e2e-machine
  - authenticate_npm:
      working_directory: ~/code/database-cli

  - run:
      name: Install dbcli
      working_directory: ~/code/database-cli
      background: true
      command: |-
        # Set Node 16
        nvm install v16.13.0
        nvm use v16.13.0
        nvm alias default v16.13.0
        yarn install --frozen-lockfile --cache-folder=".yarn-cache"

        touch /tmp/dbcli_finished.txt
