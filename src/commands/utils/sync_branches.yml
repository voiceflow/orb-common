parameters:
  checkout:
    description: Checkout code
    type: boolean
    default: false
  source_branch_name:
    description: Name of the source branch
    type: string
    default: "master"
  destination_branch_name:
    description: Name of the production branch
    type: string
    default: "production"
  step_name:
    description: Name of the step
    type: string
    default: Sync 2 branches
  ssh_key:
    description: The SSH key with write permissions to the repository
    type: string
  check_commit_message:
    description: The SSH key with write permissions to the repository
    type: string
    default: ""
steps:
  - when:
      condition: << parameters.checkout >>
      steps:
        - checkout
  - add_ssh_keys: # To enable write access to repository
      fingerprints:
        - << parameters.ssh_key >>
  - run:
      name: << parameters.step_name >>
      environment:
        CHECK_COMMIT_MESSAGE: << parameters.check_commit_message >>
        DESTINATION_BRANCH: << parameters.destination_branch_name >>
        SOURCE_BRANCH: << parameters.source_branch_name >>
      command: <<include(scripts/utils/sync-branches.sh)>>
