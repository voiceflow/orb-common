parameters:
  commit_message:
    description: Commit message to check
    type: string
steps:
  - run:
      name: Check commit message
      environment:
        CHECK_COMMIT_MESSAGE: '<< parameters.commit_message >>'
      command: |
        # If a message has been introduced, we have to check that in the commit message, if it is not included, the braches will not be synced
        # this is for the use case of the bugfix mechanism
        COMMIT_MESSAGE="$(git log --format=oneline -n 1 $CIRCLE_SHA1)"
        if [[ $COMMIT_MESSAGE != *"$CHECK_COMMIT_MESSAGE"* ]]; then
          circleci-agent step halt
        fi
