parameters:
  install_args:
    description: Additional yarn install command options
    type: string
    default: ""
  working_directory:
    description: Directory containing package.json
    type: string
    default: "./"
  step_name:
    description: Name of the step
    type: string
    default: Install node modules
  yarn_lock_restore_cache_directory:
    description: Cache directory for yarn.lock file
    type: string
    default: "./"
  cache_prefix:
    description: Cache prefix
    type: string
    default: ""
  avoid_post_install_scripts:
    description: Skip running post install scripts
    type: boolean
    default: true
  run_in_background:
    description: Run yarn install in background mode
    type: boolean
    default: false
  wait:
    description: wait until all the commands are finished
    type: boolean
    default: false
  run_in_container:
    description: Run build in a container
    type: boolean
    default: false
  request_remote_docker:
    description: Request remote Docker
    type: boolean
    default: false
  container_folder_to_copy:
    description: Container folder to copy after the execution
    type: string
    default: ""
  language:
    description: language to execute
    type: string
    default: "node"
  container_image:
    description: Container image to run the yarn command
    type: string
    default: "168387678261.dkr.ecr.us-east-1.amazonaws.com/ci-node-build-image:v1"
steps:
  - authenticate_npm
  - restore_cache:
      name: Restore pnpm Package Cache
      keys:
        - pnpm-packages-{{ checksum "pnpm-lock.yaml" }}
  - run:
      name: Install pnpm package manager
      command: |
        sudo corepack enable
        corepack prepare pnpm@latest-9 --activate
        pnpm config set store-dir .pnpm-store
  - run:
      name: Install Dependencies
      command: |
        pnpm install
  - save_cache:
      name: Save pnpm Package Cache
      key: pnpm-packages-{{ checksum "pnpm-lock.yaml" }}
      paths:
        - .pnpm-store
