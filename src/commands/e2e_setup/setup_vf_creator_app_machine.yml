parameters:
  github_username:
    description: username for cloning git repositories
    type: env_var_name
  github_token:
    description: token for cloning git repositories
    type: env_var_name
  creator_app_commit:
    description: git commit hash for database-cli
    type: env_var_name
    default: CIRCLE_SHA1
  build_dependencies_command:
    description: command to call when building dependencies for the monorepo
    type: string
    default: yarn build:deps
steps:
  - clone_repo:
      step_name: "Downloading Creator App"
      github_username: "<< parameters.github_username >>"
      github_token: "<< parameters.github_token >>"
      github_commit: "<< parameters.creator_app_commit >>"
      github_repo_name: "creator-app"
      path_to_clone: "~/code/creator-app"
  - vf_restore_cache:
      yarn_lock_restore_cache_directory: ~/code/creator-app
      cache_prefix: e2e-machine
  - authenticate_npm:
      working_directory: ~/code/creator-app
  - run:
      name: Build creator app
      working_directory: ~/code/creator-app
      background: true
      environment:
        COMMAND: << parameters.build_dependencies_command >>
      command: <<include(scripts/e2e/build-creator-app.sh)>>
