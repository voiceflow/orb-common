executor: smoke-executor
parallelism: 4

parameters:
  env-name:
    type: string
    default: ""
  branch:
    type: string
    default: "master"
  tags:
    type: string
    default: ""
  qualitywatcher:
    type: boolean
    default: false
steps:
  - clone_repo:
      github_repo_name: automated-testing
      github_commit: << parameters.branch >>
      path_to_clone: ~/project
  - install_node_modules:
      avoid_post_install_scripts: false
      cache_prefix: smoke-test
  - run:
      name: Run Smoke Tests
      environment:
        CREATOR_APP_URL: https://creator-<< parameters.env-name >>.br.development.voiceflow.com
        CYPRESS_INCLUDE_TAGS: << parameters.tags >>
        QUALITYWATCHER_ENABLED: << parameters.qualitywatcher >>
      command: yarn test:smoke
  - store_test_results:
      path: apps/smoke-test-runner/cypress/results
  - store_artifacts:
      path: apps/smoke-test-runner/cypress/downloads
      destination: downloads
  - store_artifacts:
      path: apps/smoke-test-runner/cypress/videos
      destination: videos
  - store_artifacts:
      path: apps/smoke-test-runner/cypress/screenshots
      destination: screenshots
