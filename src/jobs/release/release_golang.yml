executor: go-executor
parameters:
  release_package:
    description: Release package
    type: string
  ssh_fingerprint:
    description: SSH Key
    type: string
steps:
  - checkout
  - add_ssh_keys:
      fingerprints:
        - "<< parameters.ssh_fingerprint >>"
  - run:
      name: Install and run golang semantic release
      environment:
        RELEASE_PACKAGE: << parameters.release_package >>
      command: <<include(scripts/release/install-semantic-release.sh)>>
  - run:
      name: Get latest tag
      command: git pull
  - run:
      name: Directly run goreleaser
      environment:
        GOPRIVATE: github.com/voiceflow
      command: |-
        git config --global url."https://$GITHUB_TOKEN:x-oauth-basic@github.com/".insteadOf "https://github.com/"
        curl -sL https://git.io/goreleaser | bash
